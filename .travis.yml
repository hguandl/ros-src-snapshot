language: python
python: 3.7

os: osx
osx_image: xcode11.3
env: ROS_DISTRO=melodic \
     ROS_CONFIGURATION=desktop_full

install: pip3 install --user -r requirements.txt

script:
  - sudo rosdep init
  - rosdep update
  - rosinstall_generator ${ROS_CONFIGURATION} --rosdistro ${ROS_DISTRO} --deps --tar > ${ROS_DISTRO}-${ROS_CONFIGURATION}.rosinstall
  - wstool init -j2 src ${ROS_DISTRO}-${ROS_CONFIGURATION}.rosinstall

cache:
  directories:
  - "$HOME/.ros/rosdep"
  - "$HOME/Library/Caches/pip"

before_deploy:
  - tar cJf src.tar.xz src

deploy:
  provider: releases
  token: $GITHUB_TOKEN
  file: src.tar.xz
  on:
    repo: hguandl/ros-src-snapshot
    tags: true
